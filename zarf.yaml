kind: ZarfInitConfig

local:
  manifests: assets/manifests/common

  files:
    - source: https://github.com/k3s-io/k3s/releases/download/v1.21.2+k3s1/k3s
      shasum: 5097d515e220f8e97ab13c56cb9142ee4526b4c9eade5ed098e2906c1db2a163
      target: "/usr/local/bin/k3s"
      executable: true
    - source: assets/scripts/k3s-remove.sh
      target: "/usr/local/bin/k3s-remove.sh"
      executable: true
    - source: assets/scripts/k3s.service
      target: "/etc/systemd/system/k3s.service"

  images:
    # K3s images
    - docker.io/rancher/coredns-coredns:1.8.3
    - docker.io/rancher/klipper-helm:v0.5.0-build20210505
    - docker.io/rancher/klipper-lb:v0.2.0
    - docker.io/rancher/library-busybox:1.32.1
    - docker.io/rancher/library-traefik:2.4.8
    - docker.io/rancher/local-path-provisioner:v0.0.19
    - docker.io/rancher/metrics-server:v0.3.6
    - docker.io/rancher/pause:3.1

features:
  - name: management
    description: "Add the K9s terminal-based K8s UI for cluster management"
    default: true
    files:
      - source: https://zarf-public.s3-us-gov-west-1.amazonaws.com/k9s_Linux_x86_64_v0_24_11
        shasum: 18a5a33bbf58cb228e56a03380dcb6b9bb8624acab4ff63deb7364dc15d3c03f
        target: "/usr/local/bin/k9s"
        executable: true
      - source: assets/misc/k9s-theme.yaml
        target: "/root/.k9s/skin.yml"

  - name: logging
    description: "Add Promtail, Grafana and Loki (PGL) to this cluster for log monitoring."
    default: true
    manifests: assets/manifests/logging
    images:
      - grafana/loki:2.2.0
      - grafana/promtail:2.1.0
      - grafana/grafana:7.5.0
      - kiwigrid/k8s-sidecar:0.1.209
    charts:
      - name: loki-stack
        url: https://grafana.github.io/helm-charts
        version: 2.4.1

  - name: utility-cluster
    description: "Add Gitea and an image registry for serving gitops-based clusters in an airgap"
    manifests: assets/manifests/utility
    images:
      - registry1.dso.mil/ironbank/opensource/docker/registry-v2:2.7.1
      - gitea/gitea:1.13.7
    charts:
      - name: docker-registry
        url: https://helm.twun.io
        version: 1.10.1
      - name: gitea
        url: https://dl.gitea.io/charts
        version: 2.2.5
