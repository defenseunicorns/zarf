kind: ZarfPackageConfig
metadata:
  name: import-everything
  description: Test nearly every type of import
  version: 0.0.1

# This package showcases the following types of imports:
# - files (local and via HTTP)
# - charts (local and via OCI)
# - images (via a registry)
# - repos (via https:// or file://), git@ and ssh:// are also supported but not shown here
# - components (local and via OCI)

components:
  - name: import-component-local
    required: false
    import:
      path: foo
      name: baz

  - name: import-component-local-relative
    required: false
    import:
      path: ../../../../examples/dos-games
      name: baseline

  - name: import-component-local-absolute
    required: false
    import:
      path: /tmp/dos-games
      name: baseline

  - name: import-component-oci
    required: false
    import:
      # name is optional, if not provided the name of the component will be used to import
      name: demo-helm-local-chart
      url: oci://localhost:666/test-helm-local-chart:0.0.1

  - name: file-imports
    required: false
    files:
      # Import of a file within the current directory
      - source: files/coffee-ipsum.txt
        target: files/coffee-ipsum.txt
        # Import of a file from a relative path external to the current directory
      - source: ../everything-external/files/coffee-ipsum.txt
        target: files/latte.txt
        # Import of a file from an absolute path external to the current directory
      - source: /tmp/nocode/README.md
        target: files/nocode-readme.md
        # Import of a file from a URL
      - source: https://raw.githubusercontent.com/defenseunicorns/zarf/main/README.md
        target: files/zarf-readme.md
    actions:
      onDeploy:
        after:
        - cmd: test -f files/coffee-ipsum.txt
        - cmd: test -f files/latte.txt
        - cmd: test -f files/nocode-readme.md
        - cmd: test -f files/zarf-readme.md

  - name: import-helm
    required: false
    charts:
      - name: local-demo
        localPath: charts/local
        namespace: local-chart
        version: 0.1.0
      - name: local-demo
        localPath: ../everything-external/charts/local
        namespace: local-chart-relative
        version: 0.1.0
      - name: local-demo
        localPath: /tmp/everything-external/charts/local
        namespace: local-chart-absolute
        version: 0.1.0
      - name: oci-demo
        version: 6.3.3
        namespace: podinfo
        url: oci://ghcr.io/stefanprodan/charts/podinfo
    images:
      - nginx:1.16.0
      - ghcr.io/stefanprodan/podinfo:6.3.3
    actions:
      onDeploy:
        after:
          - wait:
              cluster:
                kind: pod
                name: app.kubernetes.io/name=oci-demo-podinfo
                namespace: podinfo
                condition: ready
          - wait:
              cluster:
                kind: deployment
                name: local-demo
                namespace: local-chart
                condition: available

  - name: import-repos
    required: false
    repos:
      # Import a full repo via HTTPS
      - https://github.com/kelseyhightower/nocode.git
      # Import a full repo via file:// + absolute path
      - file:///tmp/nocode
      # # Import this repo via file:// + relative path
      # - file://../../

  - name: import-images
    required: false
    images:
      - nginx:1.16.0
      - ghcr.io/stefanprodan/podinfo:6.3.3

  - name: import-data-injections
    required: false
    dataInjections:
      - source: files/coffee-ipsum.txt
        target:
          namespace: some-namespace
          selector: some-selector
          container: some-container
          path: /coffee-ipsum.txt
