apiVersion: v1
kind: Namespace
metadata:
  name: pepr-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
rules:
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
subjects:
  - kind: ServiceAccount
    name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
    namespace: pepr-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
  namespace: pepr-system
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-api-token
  namespace: pepr-system
type: Opaque
data:
  value: >-
    MmQ1M2FiOWJmZTQzNTM3OGM5NGZiODA0OWYxNWI4ZGY0MWZjNWZhZGZmNGY1Nzg2MjZiYjVlODUwNWExZTNhNg==
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-tls
  namespace: pepr-system
type: kubernetes.io/tls
data:
  tls.crt: >-
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDd3pDQ0FhdWdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBQU1CNFhEVEl6TVRBeE9URTRNemd6DQpPVm9YRFRJME1UQXhPVEU0TXpnek9Wb3dBRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DDQpnZ0VCQUxSQU83WFUrblhyTnFQZWxCT0RrMGdwaVR0aUJWMUN4aldST0RMdDFFVUVKd09rLy9HOXFSUHlFNjdsDQordHliKzhEWnpYd0tJeTAzei9DSUpKMDROOTcwQ2tmQjk4REo3Q2pjTnVXcU5PR2IvU3NNZUF0K1Zaem9MZXEvDQp3dFdkWmxhbXBoZnRJa3lqMXM5dldZcW9NTUtnN0gzMk5ZZ085Q1FTcWk4M1ZMNlJVcktLOWI5U3RxSTh0NXFqDQpvSVJvT0VSUnplYzNnM05IZ01WVnhiTDllYjI0UjEybHo5anc4MjV6Y0pheVo0T2g5WTdNWnBQUkZtRFNnbjdyDQpXa2pRWFRVY0QxNTFCL2dmMUpuVWVPKzdHVVVCSERrNXZSNW5WSTBvR1l1ZEM5Q1VFc2dDdHJubE9CMGE2VFMyDQpiOG1OTHRQd3dTMno4YjcxZzhndlUyK1RSSEVDQXdFQUFhTklNRVl3UkFZRFZSMFJCRDB3TzRJNWNHVndjaTFqDQpZalUyT1RObFppMWtNVE5qTFRWbVpURXRZalZoWkMxak9EY3dabVE1TVRGaU0ySXVjR1Z3Y2kxemVYTjBaVzB1DQpjM1pqTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFBVUJYZGQxYUdraklES0Z3QVBvUXE3N0dqNzN3NkFEYUdTDQpmK0s4Lzl0a3J0VEFsRnpjdUZCRHYvTzQwMW1VYTV5TFFuQnB6aERlRWd3Zk4yOFN1UzVwMnVXNTU1MWhoWXBvDQpNNGE1SUx2aCtnUUFmaVVjY3NzamUxSHFWb1pBR2ExWlNjSldtZkVUT3VLdHlJRklVZmtUc3dlNTRnUUk5SnBmDQo0ZTZVNk1jODJOSXNEeVFSK1psYkV3dUs1MWh1TlFaVHJZa1N4azdSWFo3Y21idkNGak9MbHFKVlFHNWlSZ2ZiDQpYNkVpTGducDBkM3dJSFZ1MzRmTmRpSlVJY2ZXYmsyajA1NkdRUHZwdnBFTzN2eTY5ei9PaThLOFFkTUpLTVJ4DQpGak8xYW8veWFoMjh0VUNlVmJhMlhCQ2ZmNlBGcXdnbHJ0b2N2UjU3UUNJV0ZsUDBtck9CDQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tDQo=
  tls.key: >-
    LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQ0KTUlJRW9nSUJBQUtDQVFFQXRFQTd0ZFQ2ZGVzMm85NlVFNE9UU0NtSk8ySUZYVUxHTlpFNE11M1VSUVFuQTZULw0KOGIycEUvSVRydVg2M0p2N3dObk5mQW9qTFRmUDhJZ2tuVGczM3ZRS1I4SDN3TW5zS053MjVhbzA0WnY5S3d4NA0KQzM1Vm5PZ3Q2ci9DMVoxbVZxYW1GKzBpVEtQV3oyOVppcWd3d3FEc2ZmWTFpQTcwSkJLcUx6ZFV2cEZTc29yMQ0KdjFLMm9qeTNtcU9naEdnNFJGSE41emVEYzBlQXhWWEZzdjE1dmJoSFhhWFAyUER6Ym5Od2xySm5nNkgxanN4bQ0KazlFV1lOS0NmdXRhU05CZE5Sd1BYblVIK0IvVW1kUjQ3N3NaUlFFY09UbTlIbWRValNnWmk1MEwwSlFTeUFLMg0KdWVVNEhScnBOTFp2eVkwdTAvREJMYlB4dnZXRHlDOVRiNU5FY1FJREFRQUJBb0lCQUFRQnU4WU82UDZoS3ZTMQ0KY2xtVThwdWZlejdGL3ZnbnoyWENUN05QbnJqbVJzcjlvbWdjY3Y5SDBielEvVXlsUGNGWG9ob0dWR241V0RLbw0KeHhZVTJXYVlDb2kxOE1qQkFGSTM4M016WDNPdXFzLzN1ZTBvK3JTWFEycUpCdGJtWmQrS0dxMzBXaTlsa3JWSA0KbkpBZ3pSMHRkRFpZV0ZBcEEyK3dGOGIvQ2cvbW0rWXJMUVkyM3ZBSS9xeGJNZVFxdzBvdWg5bkt6MVc2Ni9uQw0KUndvajFtalV3a3BkNjhRNCtCamJ1RGdYSlFRaWhTaDlESUo2MkFVY1BoU0RjVXp3Q2VOUmJZR3ZZU2hTd1dlcA0Kd0lWK3ZLdjRLRWlyMzcybUQzWmE3aDA2MkFtbitXcHl5OU5BKzJVSWJ0dTUvcXNHMXJMaEVlR2RJdkFVc0xYQg0KVDNldlFlRUNnWUVBNFZHTmFhSG0wdXhlQkxWZFN6dG5YMUQ0Y2MyWXJvV3Zxd0txSFpBU3F1LzVRZHZBemlBNA0KaDZLaGp0c1J1NEtRRm90RFhlZk5pSmltcVRPN0FvakhHWFVkTVdWc0tzNXBkRk1jK2RDaEUvTkF2TnQyeDVxbQ0KUmtqZjN2K3VFMXJWQmh2VExQVXZSc0tzeGFMRnpUbWphVURVa1A4OGZGNnR2ZVFvNmNCL054RUNnWUVBek11bg0KYXluaUs1N3pGRkZuQk1XZTl2R090WG9aU2w4N1dFM2Q5Zm5BeElRYit6Ry9qYnBrYndpVGovR2ZGL1h5NFlGaQ0KZS9ubHM5QU9CNTVUUktER00ydnhhVEdtUVJxL1BqdU5kR0Y0UHg1eWp1aUdSYWNjS1VRNVlwM3o2T1d1aE1NVQ0KcUswcUVsZmJpVjFGR2RVZGVQYTE2ZXk0VUhmbmJJc29zZmxlOTJFQ2dZQmRaNUZYMk9YM1NrVXZibi9lVUNIcQ0KUVlhOHBwNUV1dWEzM2NMbnZuSCtxcnlKc0srY3czNnJ1NTk5dVJNQXlIOHkyVWgwQlVRTy9Ea2FxM2M2OWJpVA0KdFJrRkFTWjJHRnRlL1pWbGVqZE1MZXNJWDNJK0RMNGhKTlNwZlJTTXNYcmRyV3M5bCthaFR0S1FtNG1rS2VDMA0KSVV2OVQ5R2pQUnlKTzZ3Nk9yS0NBUUtCZ0RVeDVQL0o5a3g4VWdtQ0IyOU80YmFsRWZ1RGhwUXgzbGxXaUlQKw0KNXBwazhsdXlGVjU3L3VCMGF0ZmwyL3crVDJOUjEwSDZyRGFqb1RGTFo3ZVl4MExPRS92T0FMQkNnVkJwNlpsRQ0KUkJhcEV2cVozVjYwUkhWWG1reEtXUE95elQwQTZ4blJPTzlnME02Q1lwT09Mc1NmMktxMWFUN0ZsbUEwV1ZLNQ0KUW5paEFvR0FCMkJJdnVUQ1kyV20wc0NteC96N1p6NHdPZmxZNUpuUFZ6QytuRCsxZHdsQ3NPbVhnRFBHRTBRNw0KUUpoKzVGL0VBWXVIL2ZkYWJTNTBQaTVYeW9aNnh2bG4xeGQ2MXdwVjJQUFNJb1lwRFhia2Q0MFBBcmFrUCtHSw0KallzTnFXa3AwamJGd1MwOHRZenVab0JRL04yOFQvRkluYndEQkR6aEpqcnpCdzRLTzAwPQ0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0NCg==
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
  namespace: pepr-system
  labels:
    app: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
  template:
    metadata:
      labels:
        app: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
    spec:
      priorityClassName: system-node-critical
      serviceAccountName: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
      containers:
        - name: server
          image: ghcr.io/defenseunicorns/pepr/controller:v0.14.2
          imagePullPolicy: IfNotPresent
          command:
            - node
            - /app/node_modules/pepr/dist/controller.js
            - 7baa4bf6a236e68053f0af1c8eaef4b2bb689f47e4dfa89315779d6a799a976b
          readinessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3000
              scheme: HTTPS
          ports:
            - containerPort: 3000
          resources:
            requests:
              memory: 64Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 500m
          env:
            - name: PEPR_PRETTY_LOG
              value: 'false'
            - name: LOG_LEVEL
              value: debug
          volumeMounts:
            - name: tls-certs
              mountPath: /etc/certs
              readOnly: true
            - name: api-token
              mountPath: /app/api-token
              readOnly: true
            - name: module
              mountPath: /app/load
              readOnly: true
      volumes:
        - name: tls-certs
          secret:
            secretName: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-tls
        - name: api-token
          secret:
            secretName: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-api-token
        - name: module
          secret:
            secretName: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-module
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
  namespace: pepr-system
spec:
  selector:
    app: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-watcher
  namespace: pepr-system
spec:
  selector:
    app: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-watcher
  ports:
    - port: 443
      targetPort: 3000
---
apiVersion: v1
kind: Secret
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-module
  namespace: pepr-system
type: Opaque
data:
  module-7baa4bf6a236e68053f0af1c8eaef4b2bb689f47e4dfa89315779d6a799a976b.js.gz: >-
    H4sIAAAAAAAAE61WbW/bNhD+3l/BckUiDRRrL+uWylC8IN2Kbm1TJC0KLPAQSjzJqmVSI6l4nqr/vqNkJ27rbP2wD5ap4x3v5XnuqBthSJqcpx8gc1xCXip4Y3QNxq0nN7hXJ4FiOkxOUvynSiyBsvZGVA3EmmVa5WXRGJFWED8cdWFvUiUG/mxKAwGtoTZ0kC6T1lvHFP4Sy7qCaAXpXOsFZTdgbKlVTEd8xMeUSbCZKWvXyyhbwHqljbTx1XAco4tji89aV2W2jkAVGLN/x81oqWVT+TcLWWNKt6YzNmjYuFVaov+TZHyMjka0Y94kvi+spillTLP0yQ9PjyCP5Pgoi57kMI7SJ0JG2fGPo1w+HY/To5QyrX42RpuYloXSBv2LaiXW9kX/NniwtcgwiKsZq0QKlV91HRsyxdjo4khGFlxT09ivSVY11oEhEipwQPrsJNyQgwOyu50ZELvbUbQ4spEwBTmMUJA2xU8WDJY4Hh1ixhJqUBJUVvqC9PnTP7Dq3/PvaNf1QLm98MlEwYo4fiZqkZYVVja4r3Cf4HdKbOm3yUaNZLcHEKeJnesV8b+NtSWI9YKsSjcnvwuTE6zaQhSAZagrvV6CcpZTtltQ+jfq0VkXsvb9HFS86BI5WQSOC34JWB4X8hf2rC+TPDfvaukXAQrV6+0pwXBGyN+j35ceHsx9cBwNjqNS5RoVXjUOzQOVnLQIC9GJ4hdixYAZZpOH44kz69Ykwuk00Bw9if4R+s1RlwmXzXF7Z6fzBpD8enn+mtfCWAhMOOgFImzd3GBpfOF7egXXv4iyAukL1ysTNwdi+yTvjozJo1Z012GXo4UPUhCdE5jyIROQZ3pZa+UrOZ1ezULBLebU2CRJ6LNepVQFPTjACr7UBfeJB9dv0VG2tfMOuIegI6Ul2GcGhdV6gxFaX4cM+K36+w20U34lpr3dDJfUgXW3pEGJTnuiyuegwAjPHowIeHH7Oh0C6kl9f0RzYYmoEG65xrXE7Dc+kIE4ExB7goUhpePktXYbIcZMhNJYTsOvwzjYE/3Hj/ukSdvtzfVqCGeWtJ/muZ02nwjZAEBMLxqlfPHZl7WIdyuBg6NAfi3BiR52fyYb/sIwnHgoH46mOzRLUqdF0LPMOoMuynwdoG68q/PFNs5zYdcqI3mjMu+XFP1l0IqVKB3Jg/EonHiGQTI0EDPbBvAKwYg5/tuxDZFJi1LJu3bc6TwI+XNwgdqyvkTW9zDDwPhhrpI74hfobzsUBuqTw0et6g5JqcjtXPAy6A59L3yWVhn63vBR26FPzW6fit1WtCHLErEHXL2HwJPsHgqLHeCwq7Jtu9HLJssAJEi8LvY6+dxFkoXM/AeoAvH3GPw7Aqd1XeEA3xJow0p1N1djwLui3+mfO16Rey02UDZc+F+LWtOP3f8BuK4OCrzdK4D6VMmzuVAFXPYFxYvqlqc5EqpFD41R/fjET5pliYjq5ATv2LflEnTjAs3Ut2M4CkM8NN8ciqd4g4q/wbvvVf81ESzZlZyFkwePH39DrG4w91eirjGsdxcvk/7m/ZqvBP7B8qWoH/wDwfCWUHIJAAA=
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: peprstores.pepr.dev
spec:
  group: pepr.dev
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            data:
              type: object
              additionalProperties:
                type: string
  scope: Namespaced
  names:
    plural: peprstores
    singular: peprstore
    kind: PeprStore
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-store
  namespace: pepr-system
rules:
  - apiGroups:
      - pepr.dev/*
    resources:
      - peprstores
    resourceNames:
      - ''
    verbs:
      - create
      - get
      - patch
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-store
  namespace: pepr-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-store
subjects:
  - kind: ServiceAccount
    name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b-store
    namespace: pepr-system
---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
webhooks:
  - name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b.pepr.dev
    admissionReviewVersions:
      - v1
      - v1beta1
    clientConfig:
      caBundle: >-
        LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlDdERDQ0FaeWdBd0lCQWdJQkFUQU5CZ2txaGtpRzl3MEJBUXNGQURBY01Sb3dHQVlEVlFRREV4RlFaWEJ5DQpJRVZ3YUdWdFpYSmhiQ0JEUVRBZUZ3MHlNekV3TVRreE9ETTRNemxhRncweU5ERXdNVGt4T0RNNE16bGFNQUF3DQpnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDY2RacjhhSnJFUDh2YUUwVGNISmFVDQpWL1lvRWpnTUNwUVMyQzYxajNSNUtvQjJ3Q0xRYlptY0FxNkxDREJVbkRZVnBPTGIwMTZMcUJMVlpHcjFtUFFHDQpmWFl6L3IvVjlDSUZsRTB3V1hnV21aL2pONHc0U3lvVERDM2JvRXlIY0VlSU13Q2d3S0g0MXJNZGl5ZUwzbnQxDQpoanBJQU9qWUxMdUovcC9uMHV2amJRSWRlZnVvM3VWWXFyR0FNNDBWQVdKcytzOEg1UCtuUy9BY1pzWjJ5aEpRDQpTcVZIbmJlKzFTelFQTzBDbUJKMm05RGhSanhQakk0VklCY3gvZDQ0bjc5SzNVVTdTWnR5cTczaDhOOE1jdnV3DQpqTktjY1N3Y1lYR0FLQ014eG1oMnRPQjQ2aDVOTmlHOVJ1OVFVdEJXeU9iM08zUEJmdTBPUXgvVEhMbGY4T3lsDQpBZ01CQUFHakhUQWJNQXdHQTFVZEV3UUZNQU1CQWY4d0N3WURWUjBQQkFRREFnTDBNQTBHQ1NxR1NJYjNEUUVCDQpDd1VBQTRJQkFRQWUvd25MdHo0RlNtdHJMSFRpNjFOUWVmUTZGNzhrYzZscThBNGxIR29kT3dXcWNTb0NRdjZMDQpSNDR3M1JKdk0wek5zR0RvY3VIUlR0aFhjWVZZN1Q1a3lKKzZXdW5hQ2ZzT2RKMFh2NDlkS3hrTHhlRDVkZzhaDQoyQmhkbzJxSkY4cFNHMjhtMm5aMmlwbHYzcDVSUGhpbnFwRlpsNU5YRFh6d215d1RRbzdraStVbHNQNTJiS29SDQpUd2h2cFl2cmNqTW9RaEowKy9sNXlNQ1FSNVR2NHhRbFkwcVo2b0VCZ2RUMHhKSmZXcEc4SjF0YlY0aFI2QlFkDQpnbXk2N2tncUV5OWFYMGgvNXcvU3U2VHFsMlhVNWkzN1dWYUhkT3R6c2pFUlZwM0tieTMzUnM1blBRL2NNVDN5DQo5RGcxSHd6OC96RWxDdVNRZ0FhNm5GN09IR3c3L1YrZw0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ0K
      service:
        name: pepr-cb5693ef-d13c-5fe1-b5ad-c870fd911b3b
        namespace: pepr-system
        path: >-
          /mutate/2d53ab9bfe435378c94fb8049f15b8df41fc5fadff4f578626bb5e8505a1e3a6
    failurePolicy: Ignore
    matchPolicy: Equivalent
    timeoutSeconds: 10
    namespaceSelector:
      matchExpressions:
        - key: pepr.dev
          operator: NotIn
          values:
            - ignore
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values:
            - kube-system
            - pepr-system
    objectSelector:
      matchExpressions:
        - key: pepr.dev
          operator: NotIn
          values:
            - ignore
        - key: kubernetes.io/metadata.name
          operator: NotIn
          values:
            - kube-system
            - pepr-system
    rules:
      - apiGroups:
          - ''
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - secrets
    sideEffects: None
